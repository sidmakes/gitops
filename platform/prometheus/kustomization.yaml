apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: prometheus

helmCharts:
  - name: kube-prometheus-stack
    repo: https://prometheus-community.github.io/helm-charts
    version: 62.7.0
    releaseName: kube-prometheus-stack
    valuesInline:
      prometheus:
        prometheusSpec:
          storageSpec:
            volumeClaimTemplate:
              spec:
                accessModes: ["ReadWriteOnce"]
                resources:
                  requests:
                    storage: 10Gi
          resources:
            requests:
              cpu: 500m
              memory: 2Gi
            limits:
              memory: 4Gi
      
      alertmanager:
        enabled: false
      
      grafana:
        enabled: true
        adminPassword: "admin"
        ingress:
          enabled: true
          ingressClassName: nginx
          hosts:
            - grafana.sidmakes.com
          path: /
        persistence:
          enabled: true
          accessModes:
            - ReadWriteOnce
          size: 5Gi
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            memory: 256Mi
      
      kubeStateMetrics:
        enabled: true
      
      nodeExporter:
        enabled: true
      
      prometheusOperator:
        resources:
          requests:
            cpu: 100m
            memory: 100Mi
          limits:
            memory: 200Mi

resources:
  - namespace.yaml